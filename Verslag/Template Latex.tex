\documentclass[11pt,a4paper]{article}

%used packages
\usepackage{graphicx}
\usepackage[dutch]{babel} 
\usepackage{scrextend}
\usepackage{enumitem}
\usepackage{listings}
\usepackage{float}
\usepackage{titlesec}
\usepackage[table,xcdraw]{xcolor}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{xcolor}
\usepackage{listings}


%Document settings
\raggedbottom
\graphicspath{ {images/} }
\setlength{\parindent}{0em}
\setlength{\parskip}{1em}

%Custom commando's
\newcommand\litem[1]{\item{\bfseries#1.\space}}
\newcommand\tabelkleur{\rowcolor[HTML]{FFCC67}}


%Custum Variables
\def\auteureen{Roy Buitenhuis, 0895833}
\def\auteurtwee{Tim van Broekhoven, 0893122}
\def\titel{Verslag TDS01} 
\def\datum{\today}
\def\versie{0.1}
\def\status{concept}
\def\subtitel{Plan van aanpak}
\def\bedrijf{}
\def\tabelkleur{FFCC67}

%Settings for Footer and Header
\pagestyle{fancy}
\fancyhf{}
\rhead{\subtitel}
\lhead{\titel}
\lfoot{\datum}
\rfoot{Pagina \thepage \hspace{1pt} /  \pageref{LastPage}}

%Settings for document spacing
\titlespacing{\section}{0pt}{*0}{*0}
\titlespacing{\subsection}{0pt}{*0}{*0}
\titlespacing{\subsubsection}{0pt}{*0}{*0}

%Settings for code sinppeds
\lstset{basicstyle=\ttfamily,
	showstringspaces=false,
	commentstyle=\color{red},
	keywordstyle=\color{blue},
	columns=fullflexible,
	frame=single,
	breaklines=true,
	postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
}

\begin{document}
	
	\begin{titlepage}
		
		\centering
		{\huge\bfseries \titel \par}
		
		\vspace{1cm}
		{\Large\itshape \auteureen \par}
		{\Large\itshape \auteurtwee \par}
		\vspace{1cm}
		{\Large\itshape versie \versie\par}
				
		\vfill
		Vak:\par
		TDS01
		
		\vfill
		{\large \datum \par}
	\end{titlepage}

	\section{Samenvatting}
	
	\clearpage
	
	\tableofcontents
	
	\clearpage
	
	\listoffigures
	
	\clearpage
	\listoftables
	
	\clearpage
	
	\section{Versiehistorie}
	\begin{table}[H]
		\centering
		\label{Versiehistorie}
		\begin{tabular}{|p{1cm}|p{2cm}|p{6cm}|p{2cm}|}
			\hline
			\rowcolor[HTML]{FFCC67}
			\textbf{Versie} & \textbf{Datum} & \textbf{Wijzigingen} & \textbf{Auteur} \\ \hline
			0.1    & 07-09-2017 & Template    & Thijs \\ \hline
			0.2	   & 19-09-2017 & Oplevering eerste versie  & Groep \\ \hline
			&       &             &        \\ \hline
		\end{tabular}
		\caption {Versiehistorie} \label{tab:title} 
	\end{table}	


	\section{Introductie}
		\subsection{Het vak}
		TDS02 is een van de vakken die tijdens de minor 'Embedded Systems' wordt gegeven. Het vak bestaat voornamelijk uit practicum assignments die de studenten in groepjes van twee dienen te voltooien. In de eerste weken begint de les met een uitleg van de docent over de theorie achter deze assignments, die het doel hebben om de studenten te trainen in digitale signaalbewerking. Om de assignments te voltooien dienen de studenten gebruik te maken van de 'C5505 eZdsp Development Tool' van Texas Instruments.
		
		\subsection{Introductie DSP}
		Volgens Analog Devices \cite{analog} is een DSP een processor die een  	gedigitaliseerd signaal als geluid, video, temperatuur of positie op wiskundige wijze manipuleerd. Analog Devices ligt toe dat een DSP wordt ontworpen om berekeningen als "optellen", "aftrekken", "vermenigvuldigen" en "delen" in korte tijd te kunnen voltooien. Het doel van deze berekeningen is om met de informatie uit het ingangssignaal een uitgangssignaal te produceren die bruikbaar is voor een bepaalde toepassing. 
		
		\subsection{Digitale filter}
		
		\subsection{De opdracht}		
		
				
	
	\section{Ontwerp en realisatie FIR filter}
	
	\subsection{What where the requirements for this filter?}
	
	\subsection{How are the coefficients determined?}
	
	\begin{enumerate}[label=\emph{\alph*)}]
		\litem{item} Describe the settings you 					used in MATLABâ€™s FDAtool and explain the 					choices you made.
	\end{enumerate}
	
	\subsection{Show charts and tables of your filter design generated by MATLAB.}
	\subsection{De (ongeoptimalizeerde) code}
	\subsubsection{de main code.}

	\begin{lstlisting}[language=c]
#include <stdio.h>
#include <usbstk5505.h>
#include <usbstk5505_led.h>
#include <csl_intc.h>

#include "aic3204.h"
#include "fdacoefs.h"
#include "fir_buffer.h"

#define SAMPLES_PER_SECOND 8000 // possible values: 48000, 24000, 16000, 12000, 9600, and 8000
#define ADC_GAIN  0// range: 0dB to 48 dB
#define DAC_GAIN 0// range: -6dB to 29dB


extern void VECSTART(void);

FIRBuffer *buffer;
interrupt void I2S0receive() {

    fir_buffer_store_sample(buffer, AIC3204_readLeft());
    AIC3204_writeLeft(fir_buffer_output_sample(buffer, COEFFICIENTS));

}

int main(void) {
    buffer = fir_buffer_new(COEFFICIENTS_LENGTH);

    USBSTK5505_init();
    AIC3204_init(SAMPLES_PER_SECOND, ADC_GAIN, DAC_GAIN);
    IRQ_setVecs((Uint32)(&VECSTART));
    IRQ_plug(PROG1_EVENT,&I2S0receive);
    IRQ_enable(PROG1_EVENT);
    IRQ_globalEnable();

    while(1);
}
	\end{lstlisting}

	\subsubsection{De header van de fir buffer}
	\begin{lstlisting}[language=c]
#ifndef __FIR_BUFFER__
#define __FIR_BUFFER__

#include <csl_intc.h>

typedef struct {
    int size;
    Int16 *buffer;
    int currentBufferIndex;
} FIRBuffer;

FIRBuffer * fir_buffer_new(int size);
void fir_buffer_store_sample(FIRBuffer *buffer, Int16 sample);
Int16 fir_buffer_output_sample(FIRBuffer *buffer, const Int16 *coefficients);

#endif//__FIR_BUFFER__

	\end{lstlisting}
	
	\subsubsection{Code van de fir buffer}
	\begin{lstlisting}[language=c]
#include <stdlib.h>
#include "fir_buffer.h";

FIRBuffer * fir_buffer_new(int size) {
   FIRBuffer *firBuffer = (FIRBuffer *)malloc(sizeof(FIRBuffer));
   //TODO: Still have to solve potential nullpointer issues.

   firBuffer->size = size;
   firBuffer->buffer = malloc(sizeof(Int16) * size);
   firBuffer->currentBufferIndex = 0;

   return firBuffer;
}

void fir_buffer_store_sample(FIRBuffer *buffer, Int16 sample) {
    buffer->currentBufferIndex += 1;

    if(buffer->currentBufferIndex == buffer->size) {
            buffer->currentBufferIndex = 0;
    }

    buffer->buffer[buffer->currentBufferIndex] = sample;
}

Int16 fir_buffer_output_sample(FIRBuffer *buffer, const Int16 *coefficients) {
    Int32 output = 0;
    int k;
    for(k = 0; k < buffer->size; k++){
        int bufferIndex = buffer->currentBufferIndex - k;
        if(bufferIndex < 0){
            bufferIndex += buffer->size;
        }
        output += (Int32)coefficients[k] * (Int32)buffer->buffer[bufferIndex];
    }

    return((Int16)(output >> 15));
}
	\end{lstlisting}



	\subsection{Het resultaat}

	
	\bibliographystyle{plain}
	\bibliography{bibligraphy}
		
	\begin{thebibliography}{9}

	\bibitem{analog}
  		
  		\textit{A Beginner's Guide to Digital Signal Processing (DSP)},
  		Analog Devices,
  		URL: http://www.analog.com/en/design-center/landing-pages/001/beginners-guide-to-dsp.html 

	
	\bibitem{}
  		
  		\textit{},
  		Addison Wesley, Massachusetts,
  		2nd edition,
  		1994.
  		
	\bibitem{}
  		
  		\textit{},
  		Addison Wesley, Massachusetts,
  		2nd edition,
  		1994.  		
		
	\end{thebibliography}

	
	\section{Ontwerp en realisatie IIR filter}
	zie vorige sectie
	
	\section{optimizatie}
	

	\section{Conclusie en aanbevelingen}
	

\end{document}